{"version":3,"sources":["book/demos/pre_merge/countdown_with_initial.cljs"],"mappings":"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","names":["book.demos.pre-merge.countdown-with-initial/all-counters","com.wsscode.pathom.connect/resolver","book.demos.pre-merge.countdown-with-initial/counter-resolver","env","_","book.demos.pre-merge.countdown-with-initial/resolvers","book.demos.pre-merge.countdown-with-initial/default-count","options__72617__auto__","this","props","com.fulcrologic.fulcro.components/wrapped-render","map__89670","com.fulcrologic.fulcro.components/props","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","js/book","js/book.demos","js/book.demos.pre-merge","js/book.demos.pre-merge.countdown-with-initial","js/book.demos.pre-merge.countdown-with-initial.Countdown","props__72618__auto__","this__72619__auto__","temp__5733__auto__","init-state__72620__auto__","obj89681","G__89682","G__89683","goog.object/get","obj89685","com.fulcrologic.fulcro.components/configure-component!","book.demos.pre-merge.countdown-with-initial/Countdown","counter-label","counter-initial","count","p__89644","map__89645","current-normalized","data-tree","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","or__4131__auto__","com.fulcrologic.fulcro.algorithms.merge/nilify-not-found","com.fulcrologic.fulcro.dom.macro_create_element.cljs$core$IFn$_invoke$arity$3","com.fulcrologic.fulcro.components/force-children","done?","com.fulcrologic.fulcro.mutations/set-value!","book.demos.pre-merge.countdown-with-initial/ui-countdown","com.fulcrologic.fulcro.components.factory.cljs$core$IFn$_invoke$arity$2","map__89687","js/book.demos.pre-merge.countdown-with-initial.Root","obj89693","G__89694","G__89695","obj89697","book.demos.pre-merge.countdown-with-initial/Root","all-counters","com.fulcrologic.fulcro.components.get_query.cljs$core$IFn$_invoke$arity$1","com.fulcrologic.fulcro.dom/macro-create-element*","cljs.core/seq","cljs.core.mapv.cljs$core$IFn$_invoke$arity$2","com.fulcrologic.fulcro.data_fetch.load_BANG_.cljs$core$IFn$_invoke$arity$3"],"sourcesContent":["(ns book.demos.pre-merge.countdown-with-initial\n  (:require\n    [com.fulcrologic.fulcro.data-fetch :as df]\n    [book.demos.util :refer [now]]\n    [com.fulcrologic.fulcro.mutations :as m]\n    [com.fulcrologic.fulcro.dom :as dom]\n    [com.fulcrologic.fulcro.components :as comp :refer [defsc]]\n    [com.wsscode.pathom.connect :as pc]\n    [com.fulcrologic.fulcro.algorithms.merge :as merge]))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; SERVER:\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(def all-counters\n  [{::counter-id 1 ::counter-label \"A\"}\n   {::counter-id 2 ::counter-label \"B\" ::counter-initial 10}\n   {::counter-id 3 ::counter-label \"C\" ::counter-initial 2}\n   {::counter-id 4 ::counter-label \"D\"}])\n\n(pc/defresolver counter-resolver [env _]\n  {::pc/output [{::all-counters [::counter-id ::counter-label ::counter-initial]}]}\n  {::all-counters all-counters})\n\n(def resolvers [counter-resolver])\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; CLIENT:\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(def default-count 5)\n\n(defsc Countdown [this {::keys   [counter-label counter-initial]\n                        :ui/keys [count]}]\n  {:ident     [::counter-id ::counter-id]\n   :query     [::counter-id ::counter-label ::counter-initial :ui/count]\n   :pre-merge (fn [{:keys [current-normalized data-tree]}]\n                (merge\n                  ; <1>\n                  {:ui/count (or (merge/nilify-not-found (::counter-initial data-tree)) default-count)}\n                  current-normalized\n                  data-tree))}\n  (dom/div\n    (dom/h4 (str counter-label \" [\" (or counter-initial default-count) \"]\"))\n    (let [done? (zero? count)]\n      (dom/button {:disabled done?\n                   :onClick  #(m/set-value! this :ui/count (dec count))}\n        (if done? \"Done!\" (str count))))))\n\n(def ui-countdown (comp/factory Countdown {:keyfn ::counter-id}))\n\n(defsc Root [this {::keys [all-counters]}]\n  {:initial-state (fn [_] {})\n   :query         [{::all-counters (comp/get-query Countdown)}]}\n  (dom/div\n    (dom/h3 \"Counters\")\n    (if (seq all-counters)\n      (dom/div {:style {:display \"flex\" :alignItems \"center\" :justifyContent \"space-between\"}}\n        (mapv ui-countdown all-counters))\n      (dom/button {:onClick #(df/load! this ::all-counters Countdown)}\n        \"Load many counters\"))))\n"]}