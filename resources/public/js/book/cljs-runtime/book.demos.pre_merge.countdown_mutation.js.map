{"version":3,"sources":["book/demos/pre_merge/countdown_mutation.cljs"],"mappings":"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","names":["book.demos.pre-merge.countdown-mutation/default-count","options__72617__auto__","this","props","com.fulcrologic.fulcro.components/wrapped-render","map__89762","com.fulcrologic.fulcro.components/props","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","js/book","js/book.demos","js/book.demos.pre-merge","js/book.demos.pre-merge.countdown-mutation","js/book.demos.pre-merge.countdown-mutation.CountdownButton","props__72618__auto__","this__72619__auto__","temp__5733__auto__","init-state__72620__auto__","obj89767","G__89768","G__89769","goog.object/get","obj89772","com.fulcrologic.fulcro.components/configure-component!","book.demos.pre-merge.countdown-mutation/CountdownButton","count","p__89758","map__89759","current-normalized","data-tree","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","cljs.core/random-uuid","done?","com.fulcrologic.fulcro.dom.macro_create_element.cljs$core$IFn$_invoke$arity$3","com.fulcrologic.fulcro.components/force-children","com.fulcrologic.fulcro.mutations/set-value!","book.demos.pre-merge.countdown-mutation/ui-countdown-button","com.fulcrologic.fulcro.components.factory.cljs$core$IFn$_invoke$arity$2","map__89798","js/book.demos.pre-merge.countdown-mutation.Countdown","obj89806","G__89807","G__89808","obj89810","book.demos.pre-merge.countdown-mutation/Countdown","counter-label","counter-initial","counter","com.fulcrologic.fulcro.components.get_query.cljs$core$IFn$_invoke$arity$1","p__89787","map__89788","x","initial","com.fulcrologic.fulcro.algorithms.merge/nilify-not-found","G__89791","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","or__4131__auto__","book.demos.pre-merge.countdown-mutation/ui-countdown","book.demos.pre-merge.countdown-mutation/create-countdown","com.fulcrologic.fulcro.mutations/->Mutation","com.fulcrologic.fulcro.mutations/mutate","fulcro-mutation-env-symbol","p__89811","map__89812","env","temp__5735__auto__","com.fulcrologic.fulcro.algorithms.lookup/app-algorithm","default-action","countdown","state","ref","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$variadic","com.fulcrologic.fulcro.algorithms.merge/merge-component","cljs.core/update-in","cljs.core/assoc","map__89816","js/book.demos.pre-merge.countdown-mutation.Root","obj89819","G__89820","G__89821","obj89823","book.demos.pre-merge.countdown-mutation/Root","all-counters","_","com.fulcrologic.fulcro.algorithms.tempid.tempid.cljs$core$IFn$_invoke$arity$0","com.fulcrologic.fulcro.dom/macro-create-element*","cljs.core.sequence.cljs$core$IFn$_invoke$arity$1","cljs.core/seq","cljs.core.concat.cljs$core$IFn$_invoke$arity$2","cljs.core/List","com.fulcrologic.fulcro.components.transact_BANG_.cljs$core$IFn$_invoke$arity$2","cljs.core.mapv.cljs$core$IFn$_invoke$arity$2"],"sourcesContent":["(ns book.demos.pre-merge.countdown-mutation\n  (:require\n    [book.demos.util :refer [now]]\n    [com.fulcrologic.fulcro.mutations :as m]\n    [com.fulcrologic.fulcro.dom :as dom]\n    [com.fulcrologic.fulcro.components :as comp :refer [defsc]]\n    [com.fulcrologic.fulcro.algorithms.merge :as merge]\n    [com.fulcrologic.fulcro.algorithms.tempid :as tempid]))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; CLIENT:\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(def default-count 5)\n\n(defsc CountdownButton [this {:ui/keys [count]}]\n  {:ident     [:ui/id :ui/id]\n   :query     [:ui/id :ui/count]\n   :pre-merge (fn [{:keys [current-normalized data-tree]}]\n                (merge\n                  {:ui/id    (random-uuid)\n                   :ui/count default-count}\n                  current-normalized\n                  data-tree))}\n  (let [done? (zero? count)]\n    (dom/button {:disabled done?\n                 :onClick  #(m/set-value! this :ui/count (dec count))}\n      (if done? \"Done!\" (str count)))))\n\n(def ui-countdown-button (comp/factory CountdownButton {:keyfn ::counter-id}))\n\n(defsc Countdown [this {::keys   [counter-label counter-initial]\n                        :ui/keys [counter]}]\n  {:ident     [::counter-id ::counter-id]\n   :query     [::counter-id ::counter-label ::counter-initial\n               {:ui/counter (comp/get-query CountdownButton)}]\n   :pre-merge (fn [{:keys [current-normalized data-tree] :as x}]\n                (let [initial (merge/nilify-not-found (::counter-initial data-tree))]\n                  (merge\n                    {:ui/counter (cond-> {} initial (assoc :ui/count initial))}\n                    current-normalized\n                    data-tree)))}\n  (dom/div\n    (dom/h4 (str counter-label \" [\" (or counter-initial default-count) \"]\"))\n    (ui-countdown-button counter)))\n\n(def ui-countdown (comp/factory Countdown {:keyfn ::counter-id}))\n\n(m/defmutation create-countdown [countdown]\n  (action [{:keys [state ref]}]\n    (swap! state merge/merge-component Countdown countdown :append [::all-counters])\n    (swap! state update-in ref assoc :ui/new-countdown-label \"\")))\n\n(defsc Root [this {::keys [all-counters]}]\n  {:initial-state (fn [_] {::all-counters\n                           [{::counter-id    (tempid/tempid)\n                             ::counter-label \"X\"}\n                            {::counter-id    (tempid/tempid)\n                             ::counter-label \"Y\"}\n                            {::counter-id      (tempid/tempid)\n                             ::counter-label   \"Z\"\n                             ::counter-initial 9}]})\n   :query         [{::all-counters (comp/get-query Countdown)}\n                   :ui/new-countdown-label]}\n  (dom/div\n    (dom/h3 \"Counters\")\n    (dom/button {:onClick #(comp/transact! this [`(create-countdown ~{::counter-id    (tempid/tempid)\n                                                                      ::counter-label \"New\"})])}\n      \"Add counter\")\n    (dom/div {:style {:display \"flex\" :alignItems \"center\" :justifyContent \"space-between\"}}\n      (mapv ui-countdown all-counters))))\n"]}